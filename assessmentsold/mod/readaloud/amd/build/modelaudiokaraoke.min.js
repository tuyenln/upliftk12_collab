define ("mod_readaloud/modelaudiokaraoke",["jquery","core/log","mod_readaloud/definitions"],function(a,b,c){"use strict";b.debug("Model Audio helper: initialising");return{controls:{},breaks:[],endwordnumber:0,currentstartbreak:!1,cd:{audioplayerclass:c.audioplayerclass,wordplayerclass:c.wordplayerclass,wordclass:c.wordclass,spaceclass:c.spaceclass,endspaceclass:c.endspaceclass,passagecontainer:c.passagecontainer,activesentence:c.activesentence,stopbutton:"mod_readaloud_button_stop",playbutton:"mod_readaloud_button_play"},init:function init(a){if(a.breaks){this.breaks=JSON.parse(a.breaks)}if(a.audioplayerclass){this.cd.audioplayerclass=a.audioplayerclass}this.register_controls();this.endwordnumber=this.controls.eachword.length;this.register_events()},set_breaks:function set_breaks(a){this.breaks=a;this.sort_breaks()},sort_breaks:function sort_breaks(){this.breaks.sort(function(c,a){return c.audiotime-a.audiotime})},register_controls:function register_controls(){this.controls.audioplayer=a("#"+this.cd.audioplayerclass);this.controls.eachword=a("."+this.cd.wordclass);this.controls.eachspace=a("."+this.cd.spaceclass);this.controls.eachwordorspace=a("."+this.cd.spaceclass+",."+this.cd.wordclass);this.controls.passagecontainer=a("."+this.cd.passagecontainer);this.controls.stopbutton=a("#"+this.cd.stopbutton);this.controls.playbutton=a("#"+this.cd.playbutton)},register_events:function register_events(){var b=this,c=this.controls.audioplayer[0];this.controls.playbutton.on("click",function(){c.play()});this.controls.stopbutton.on("click",function(){c.pause()});this.controls.eachwordorspace.on("click",function(){for(var d=parseInt(a(this).attr("data-wordnumber")),e=!1,f=0;f<b.breaks.length;f++){if(b.breaks[f].wordnumber<d){e=b.breaks[f]}else{break}}if(!!e){c.pause();c.currentTime=e.audiotime;c.play()}});var d=function(){b.controls.eachword.removeClass(b.cd.activesentence);b.controls.eachspace.removeClass(b.cd.activesentence);b.currentstartbreak=!1};c.onended=d;c.onpause=d;c.ontimeupdate=function(){for(var d=c.currentTime,e=!1,f=!1,g=0;g<b.breaks.length;g++){if(d>=b.breaks[g].audiotime&&g+1===b.breaks.length){e=b.breaks[g];f={wordnumber:b.endwordnumber+1,audiotime:0}}else if(d>=b.breaks[g].audiotime&&d<b.breaks[g+1].audiotime){e=b.breaks[g];f=b.breaks[g+1];break}else if(0==g&&d<b.breaks[g].audiotime&&0<d){e={wordnumber:0,audiotime:0};f=b.breaks[g]}}if(!(b.currentstartbreak==e)){b.currentstartbreak=e;b.controls.eachword.removeClass(b.cd.activesentence);b.controls.eachspace.removeClass(b.cd.activesentence);if(!1!==e&&!1!==f){for(var h=e.wordnumber+1;h<=f.wordnumber;h++){a("#"+b.cd.spaceclass+"_"+h).addClass(b.cd.activesentence);a("#"+b.cd.wordclass+"_"+h).addClass(b.cd.activesentence)}}}}}}});
//# sourceMappingURL=modelaudiokaraoke.min.js.map
